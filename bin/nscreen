#!/usr/bin/env bash

name=${1:?need a screen session name}

if screen -ls | grep -Pq "\d+\.$name\s+\("  ; then
    exec screen -dr $name
else
    if [ -e $HOME/.screenrc-$name ] ; then
        config=$(cat $HOME/.screenrc $HOME/.screenrc-$name)
        checksum=$(echo "$config" | md5sum)
        checksum=${checksum% *}
        config_file=$HOME/.nscreen.$checksum
        if ! [ -f $HOME/.nscreen.$checksum ] ; then
            echo "$config" > $config_file
        fi
        exec screen -S $name -c $config_file
    else
        exec screen -S $name
    fi
fi

